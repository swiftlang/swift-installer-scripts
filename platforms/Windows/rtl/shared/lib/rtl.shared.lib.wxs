<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Fragment>
    <?if $(sys.BUILDARCH) == x64 ?>
      <?define RuntimeDirectoryComponentGuidGenerationSeed = "E33B165B-8460-467D-ABCD-27EA8197A3CF" ?>
      <?define LibexecDirectoryComponentGuidGenerationSeed = "FFC6429D-AF95-413E-B338-75642F8F7F34" ?>
      <?define RuntimeRoot = $(WindowsExperimentalRuntimeX64)?>
    <?elseif $(sys.BUILDARCH) == arm64 ?>
      <?define RuntimeDirectoryComponentGuidGenerationSeed = "BFFDD8F7-CC47-40CB-AF0E-095273FF10FC" ?>
      <?define LibexecDirectoryComponentGuidGenerationSeed = "AD26608D-63D8-45AC-AA57-D4CEEF2DF021" ?>
      <?define RuntimeRoot = $(WindowsExperimentalRuntimeARM64)?>
    <?elseif $(sys.BUILDARCH) == x86 ?>
      <?define RuntimeDirectoryComponentGuidGenerationSeed = "72064820-3795-4331-8CBD-FF1ABA7DAE7B" ?>
      <?define LibexecDirectoryComponentGuidGenerationSeed = "FCAC627D-44EC-4745-B81B-E12CE8F80951" ?>
      <?define RuntimeRoot = $(WindowsExperimentalRuntimeX86)?>
    <?endif?>

    <Directory Id="RUNTIMEDIR_$(ProductArchitecture)" ComponentGuidGenerationSeed="$(RuntimeDirectoryComponentGuidGenerationSeed)" />
    <Directory Id="LIBEXECDIR_$(ProductArchitecture)" ComponentGuidGenerationSeed="$(LibexecDirectoryComponentGuidGenerationSeed)" />

    <ComponentGroup Id="stdlib_$(ProductArchitecture)" Directory="RUNTIMEDIR_$(ProductArchitecture)">
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftCore.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftRuntime.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftCRT.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftDistributed.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftObservation.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftRegexBuilder.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftRemoteMirror.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftSwiftOnoneSupport.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftSynchronization.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftWinSDK.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swift_Builtin_float.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swift_Concurrency.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swift_Differentiation.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swift_RegexParser.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swift_StringProcessing.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swift_Volatile.dll" />
      </Component>

      <!-- TODO(compnerd) should we distribute the undecoration library in the runtime?
      <Component Directory="_usr_bin" Id="swiftDemangle.dll">
        <File Id="swiftDemangle.dll" Source="$(RuntimeRoot)\bin\swiftDemangle.dll" />
      </Component>
      -->
    </ComponentGroup>

    <!-- TODO Enable when the experimental Runtimes build builds swift-backtrace
    <ComponentGroup Id="libexec_$(ProductArchitecture)" Directory="LIBEXECDIR_$(ProductArchitecture)">
      <Component>
        <File Source="$(RuntimeRoot)\usr\libexec\swift\windows\swift-backtrace.exe" />
      </Component>
    </ComponentGroup>
    -->

    <ComponentGroup Id="BlocksRuntime_$(ProductArchitecture)" Directory="RUNTIMEDIR_$(ProductArchitecture)">
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\BlocksRuntime.dll" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="libdispatch_$(ProductArchitecture)" Directory="RUNTIMEDIR_$(ProductArchitecture)">
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\dispatch.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\swiftDispatch.dll" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="Foundation_$(ProductArchitecture)" Directory="RUNTIMEDIR_$(ProductArchitecture)">
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\Foundation.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\FoundationEssentials.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\FoundationInternationalization.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\FoundationNetworking.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\FoundationXML.dll" />
      </Component>
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\_FoundationICU.dll" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="plutil_$(ProductArchitecture)" Directory="RUNTIMEDIR_$(ProductArchitecture)">
      <Component>
        <File Source="$(RuntimeRoot)\usr\bin\plutil.exe" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="swift_runtime_$(ProductArchitecture)">
      <ComponentGroupRef Id="stdlib_$(ProductArchitecture)" />
      <!-- TODO Enable when the experimental Runtimes build builds swift-backtrace
      <ComponentGroupRef id="libexec_$(ProductArchitecture)" />
      -->
      <ComponentGroupRef Id="BlocksRuntime_$(ProductArchitecture)" />
      <ComponentGroupRef Id="libdispatch_$(ProductArchitecture)" />
      <ComponentGroupRef Id="Foundation_$(ProductArchitecture)" />
    </ComponentGroup>

    <ComponentGroup Id="swift_runtime_utilities_$(ProductArchitecture)">
      <ComponentGroupRef Id="plutil_$(ProductArchitecture)" />
    </ComponentGroup>
  </Fragment>
</Wix>
