<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <?define PythonRoot = "$(ImageRoot)\Python-$(PythonVersion)"?>
  <?if $(ProductArchitecture) = "arm64"?>
  <?define ArchSuffix = "-arm64"?>
  <?else?>
  <?define ArchSuffix = ""?>
  <?endif?>

  <Package
    Language="1033"
    Manufacturer="!(loc.ManufacturerName)"
    Name="!(loc.EmbeddedPython_ProductName)"
    UpgradeCode="$(PythonUpgradeCode)"
    Version="$(NonSemVerProductVersion)"
    Scope="$(PackageScope)">

    <Media Id="1" Cabinet="python.cab" EmbedCab="$(ArePackageCabsEmbedded)" />

    <WixVariable Id="SideBySidePackageUpgradeCode" Value="$(PythonUpgradeCode)" />
    <FeatureGroupRef Id="SideBySideUpgradeStrategy" />

    <DirectoryRef Id="INSTALLROOT">
      <Directory Id="python" Name="Python-$(PythonVersion)">
        <Directory Id="python_usr" Name="usr">
          <Directory Id="python_usr_bin" Name="bin" />
          <Directory Id="python_usr_share" Name="share">
            <Directory Id="python_usr_share_licenses" Name="licenses" />
          </Directory>
        </Directory>
      </Directory>
    </DirectoryRef>

    <ComponentGroup Id="EmbeddedPython" Directory="python_usr_bin">
      <Component>
        <File Source="$(PythonRoot)\libcrypto-1_1$(ArchSuffix).dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\libffi-7.dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\libssl-1_1$(ArchSuffix).dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\pyexpat.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\python.cat" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\python.exe" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\python3.dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\python310.dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\python310.zip" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\python310._pth" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\pythonw.exe" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\select.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\sqlite3.dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\unicodedata.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\vcruntime140.dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\vcruntime140_1.dll" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\winsound.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_asyncio.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_bz2.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_ctypes.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_decimal.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_elementtree.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_hashlib.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_lzma.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_msi.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_multiprocessing.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_overlapped.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_queue.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_socket.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_sqlite3.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_ssl.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_uuid.pyd" />
      </Component>
      <Component>
        <File Source="$(PythonRoot)\_zoneinfo.pyd" />
      </Component>

      <Component Directory="python_usr_share_licenses">
        <File Name="python.txt" Source="$(PythonRoot)\LICENSE.txt" />
      </Component>
    </ComponentGroup>

    <Feature Id="EmbeddedPython" AllowAbsent="no" Title="!(loc.EmbeddedPython_ProductName)">
      <ComponentGroupRef Id="EmbeddedPython" />
    </Feature>
  </Package>
</Wix>
